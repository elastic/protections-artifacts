[rule]
description = """
RediShell (CVE-2025-49844) is a critical (CVSS 10.0) use-after-free flaw in Redis' Lua handling that allows a post-auth
attacker to submit a crafted Lua script which breaks out of the built-in sandbox and executes native code on the host.
Exploitation yields remote code execution and can lead to full host compromise. This rule flags a behavioral pattern
consistent with exploitation: Redis (processes running as redis, children or descendants of redis-server) spawning an
executable named lua* within a short time window â€” a strong heuristic for on-host Lua interpreter invocation or a
sandbox escape that launches follow-on native payloads.
"""
id = "86c3a1a0-b3ca-4d4a-a7ee-f890ac12a48b"
license = "Elastic License v2"
name = "Potential RediShell (CVE-2025-49844) Exploitation"
os_list = ["linux"]
reference = ["https://www.wiz.io/blog/wiz-research-redis-rce-cve-2025-49844"]
version = "1.0.2"

query = '''
sequence by process.entity_id with maxspan=10s
	[process where event.type == "start" and event.action == "exec" and (
	  (process.parent.name == "redis-server") or
	  (user.name == "redis") or
	  (descendant of [process where process.name == "redis-server"])
	)]
	[process where event.type == "start" and event.action == "exec" and process.name like~ "lua*"]
'''

min_endpoint_version = "7.15.0"
optional_actions = []
[[actions]]
action = "kill_process"
field = "process.entity_id"
state = 1

[[actions]]
action = "kill_process"
field = "process.parent.entity_id"
state = 1

[[threat]]
framework = "MITRE ATT&CK"
[[threat.technique]]
id = "T1059"
name = "Command and Scripting Interpreter"
reference = "https://attack.mitre.org/techniques/T1059/"
[[threat.technique.subtechnique]]
id = "T1059.004"
name = "Unix Shell"
reference = "https://attack.mitre.org/techniques/T1059/004/"


[[threat.technique]]
id = "T1203"
name = "Exploitation for Client Execution"
reference = "https://attack.mitre.org/techniques/T1203/"


[threat.tactic]
id = "TA0002"
name = "Execution"
reference = "https://attack.mitre.org/tactics/TA0002/"
[[threat]]
framework = "MITRE ATT&CK"
[[threat.technique]]
id = "T1071"
name = "Application Layer Protocol"
reference = "https://attack.mitre.org/techniques/T1071/"


[threat.tactic]
id = "TA0011"
name = "Command and Control"
reference = "https://attack.mitre.org/tactics/TA0011/"

[internal]
min_endpoint_version = "7.15.0"
